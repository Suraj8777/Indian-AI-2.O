<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>SM AI Assistant</title>
    <style>
        body {
            margin: 0;
            padding: 20px;
            font-family: Arial, sans-serif;
            background: #0a0a0a;
            color: #00ffff;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
        }
        .jarvis-container {
            width: 400px;
            background: rgba(0, 0, 0, 0.8);
            padding: 20px;
            border-radius: 10px;
            border: 1px solid #00ffff;
            box-shadow: 0 0 20px rgba(0, 255, 255, 0.3);
        }
        .output {
            height: 200px;
            overflow-y: auto;
            margin-bottom: 20px;
            padding: 10px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 5px;
        }
        button {
            background: #00ffff;
            color: #000;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            width: 100%;
            font-weight: bold;
            transition: all 0.3s;
        }
        button:hover {
            background: #00cccc;
            transform: scale(1.05);
        }
        button:active {
            background: #009999;
        }
    </style>
</head>
<body>
    <div class="SM-container">
        <div class="output" id="output">SM: Systems online. How may I assist you, sir?</div>
        <button onclick="startListening()">Speak to JARVIS</button>
    </div>

    <script>
        const output = document.getElementById('output');
        const recognition = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
        recognition.continuous = false;
        recognition.interimResults = false;

        // Predefined responses
        const predefinedResponses = {
            'time': () => `The current time is ${new Date().toLocaleTimeString()}`,
            'who are you': () => 'I am SM, your personal AI assistant, inspired by Mr. Stark\'s creation.'
        };

        recognition.onresult = async function(event) {
            const transcript = event.results[0][0].transcript.toLowerCase().trim();
            output.innerHTML += `<br>YOU: ${transcript}`;
            
            let response;
            
            // Check for predefined responses
            for (let key in predefinedResponses) {
                if (transcript.includes(key)) {
                    response = predefinedResponses[key]();
                    break;
                }
            }
            
            if (!response) {
                // Call API for other queries
                output.innerHTML += '<br>JARVIS: Processing your request, sir...';
                output.scrollTop = output.scrollHeight;
                
                try {
                    const apiResponse = await fetch('https://openrouter.ai/api/v1/chat/completions', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'Authorization': `Bearer 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`
                        },
                        body: JSON.stringify({
                            model: 'meta-llama/llama-3.1-8b-instruct:free', // Adjust model if needed
                            messages: [
                                { role: 'system', content: 'You are JARVIS, an AI assistant inspired by the Marvel character. Respond in a formal, polite manner, addressing the user as "sir".' },
                                { role: 'user', content: transcript }
                            ]
                        })
                    });
                    
                    if (apiResponse.ok) {
                        const data = await apiResponse.json();
                        response = data.choices[0].message.content;
                    } else {
                        response = "I'm sorry, sir. I couldn't process that request at the moment.";
                    }
                } catch (error) {
                    console.error(error);
                    response = "Apologies, sir. There was an error processing your request.";
                }
            }
            
            // Remove the "Processing" message if it was added
            output.innerHTML = output.innerHTML.replace('<br>SM: Processing your request, sir...', '');
            
            output.innerHTML += `<br>SM: ${response}`;
            output.scrollTop = output.scrollHeight;
            speak(response);
        };

        recognition.onerror = function(event) {
            output.innerHTML += '<br>SM: Apologies, sir. I encountered an error.';
        };

        function startListening() {
            output.innerHTML += '<br>JARVIS: Listening, sir...';
            recognition.start();
        }

        function speak(text) {
            const utterance = new SpeechSynthesisUtterance(text);
            utterance.voice = speechSynthesis.getVoices().find(voice => voice.lang === 'en-GB') || null;
            window.speechSynthesis.speak(utterance);
        }

        // Load voices and speak initial message
        window.speechSynthesis.onvoiceschanged = function() {
            speak('Systems online. How may I assist you, sir?');
        };
    </script>
</body>
</html>
